# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные

### Интерфейсы данных


#### Интерфейс: Товар (IProduct):


```
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```
Назначение: описывает структуру данных товара в каталоге.

Пояснение полей:

`id: string` - уникальный идентификатор товара

`description: string` - подробное текстовое описание товара, его характеристик и особенностей

`image: string` - ссылка на лого товара 

`title: string` - краткое название товара

`category: string` - категория товара, к которой он принадлежит (например: "софт-скил", "хард-скил", "другое")

`price: number | null` - цена товара в числовом формате. может быть null, если товар бесценен 

#### Интерфейс: Покупатель (IBuyer):

```
interface IBuyer {
  payment: TPayment;
  email: string;
  phone: string;
  address: string;
}
```
Назначение: описывает данные покупателя для оформления заказа.

Пояснение полей:

`payment: TPayment` - информация о способе оплаты. cash или online. 

`email: string` - электронная почта покупателя для связи и отправки уведомлений о заказе

`phone: string` - номер телефона покупателя для связи и подтверждения заказа

`address: string` - адрес доставки заказа, куда будет отправлен товар

### Модели данных

#### Класс Products (Каталог товаров)
Назначение: хранит данные каталога товаров и управляет ими.

Конструктор:
`constructor()` - не принимает параметров

Поля:

`products: IProduct[]` - массив всех товаров каталога

`item: IProduct | null` - товар, выбранный для подробного отображения

Методы:

`getProducts(): IProduct[]` - возвращает массив всех товаров

`setProducts(products: IProduct[]): void` - сохраняет массив товаров

`getCard(): IProduct | null` - возвращает выбранный товар

`setCard(product: IProduct): void` - сохраняет товар для подробного отображения

`getProductById(id: string): IProduct | null` - возвращает товар по ID

#### Класс Cart (Корзина)
Назначение: управляет товарами в корзине покупок.

Конструктор:
`constructor()` - не принимает параметров

Поля:

`products: IProduct[]` - массив товаров в корзине

Методы:

`getProductsList(): IProduct[]` - возвращает массив товаров в корзине

`addProduct(product: IProduct): void` - добавляет товар в корзину

`deleteProduct(id: string): void` - удаляет товар из корзины по ID

`clearCart(): void` - очищает корзину

`getTotalPrice(): number` - возвращает количество товаров в корзине

`getProductsValue(): number` - возвращает общую стоимость товаров

`getQuanity(): number` - возвращает количество товаров в корзине

`contains(id: string): boolean` - проверяет наличие товара по ID

#### Класс Buyer (Покупатель)
Назначение: хранит и валидирует данные покупателя.

Конструктор:
`constructor(payment: TPayment, address: string, email: string, phone: string)` - принимает начальные данные покупателя

Поля:

`payment: TPayment` - способ оплаты

`address: string` - адрес доставки

`email: string` - email покупателя

`phone: string` - телефон покупателя

Методы:

`setData(info: IBuyer): void` - сохраняет данные покупателя

`getData(): IBuyer` - возвращает все данные покупателя

`clearData(): void` - очищает данные покупателя

`validateData(): boolean` - валидирует данные и возвращает результат проверки

### Слой коммуникации

#### Класс ShopApi
Назначение: отвечает за взаимодействие с API сервера.

Конструктор:
`constructor(api: Api)` - принимает экземпляр класса Api

Поля:

`api: Api` - экземпляр API для выполнения запросов

Методы:

`getProducts(): Promise<IOrderRequest>` - получает список товаров с сервера

`postResponse(order: IOrderRequest): Promise<IOrderResult>` - отправляет данные заказа на сервер

### Слой представления

#### Класс Card
Назначение: Базовый класс для отображения карточки товара. Предоставляет общую структуру и методы для работы с элементами карточки.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент, за отображение которого он отвечает.

Поля:
`protected title: HTMLElement` - элемент для отображения заголовка карточки.
`protected price: HTMLElement` - элемент для отображения цены карточки.

Методы:
Наследует методы `render` и `setImage` от базового класса `Component`.

#### Класс CardCart
Назначение: Отображает карточку товара в корзине. Включает функционал для удаления товара из корзины и отображения его цены.

Конструктор:
`constructor(container: HTMLElement, actions?: IBacketActions)` - принимает ссылку на DOM элемент контейнера и опциональный объект с действиями для корзины.

Поля:
`protected deleteBtn: HTMLButtonElement` - кнопка для удаления товара из корзины.
`protected index: HTMLElement` - элемент для отображения индекса товара в корзине.

Методы:
`set indexCard(value: string)` - устанавливает текстовое содержимое для элемента `index`.
`set titleCard(value: string)` - устанавливает текстовое содержимое для элемента `title` (наследуется от `Card`).
`set priceCard(value: string)` - устанавливает текстовое содержимое для элемента `price` (наследуется от `Card`), добавляя "синапсов".

#### Класс CardCatalog
Назначение: Отображает карточку товара в каталоге. Позволяет просматривать информацию о товаре и добавлять его в корзину.

Конструктор:
`constructor(container: HTMLElement, actions?: ICardActions)` - принимает ссылку на DOM элемент контейнера и опциональный объект с действиями для карточки.

Поля:
`protected image: HTMLImageElement` - элемент для отображения изображения товара.
`protected category: HTMLElement` - элемент для отображения категории товара.

Методы:
`set cardCategory(value: string)` - устанавливает текстовое содержимое и класс для элемента `category` в зависимости от значения категории.
`set cardImage(value: string)` - устанавливает изображение для элемента `image`.
`set cardPrice(value: number | null)` - устанавливает текстовое содержимое для элемента `price` (наследуется от `Card`), отображая "Бесценно" или цену с "синапсов".
`set cardTitle(value: string)` - устанавливает текстовое содержимое для элемента `title` (наследуется от `Card`).

#### Класс CardView
Назначение: Отображает подробную информацию о товаре в модальном окне. Включает полное описание, изображение и возможность добавления в корзину.

Конструктор:
`constructor(container: HTMLElement, actions?: ICardActions)` - принимает ссылку на DOM элемент контейнера и опциональный объект с действиями для карточки.

Поля:
`protected category: HTMLElement` - элемент для отображения категории товара.
`protected description: HTMLElement` - элемент для отображения полного описания товара.
`protected image: HTMLImageElement` - элемент для отображения изображения товара.
`protected buttonEl: HTMLButtonElement` - кнопка для добавления или удаления товара из корзины.

Методы:
`set cardPrice(value: number | null)` - устанавливает цену товара, отключает кнопку и меняет ее текст, если товар бесценен.
`set cardImage(value: string)` - устанавливает изображение товара.
`set cardCategory(value: string)` - устанавливает категорию товара и соответствующий класс стилей.
`set cardTitle(value: string)` - устанавливает заголовок товара.
`set cardDescription(value: string)` - устанавливает описание товара.
`set buttonText(value: string)` - устанавливает текст на кнопке.

#### Класс Cart
Назначение: Отображает содержимое корзины. Показывает список добавленных товаров, их количество, кнопку удаления и общую стоимость товаров в корзине.

Конструктор:
`constructor(container: HTMLElement, actions?: IBasketAction)` - принимает ссылку на DOM элемент контейнера и опциональный объект с действиями для корзины.

Поля:
`protected totalPriceEl: HTMLElement` - элемент для отображения общей стоимости товаров в корзине.
`protected basketList: HTMLElement` - элемент-контейнер для списка товаров в корзине.
`protected orderButton: HTMLButtonElement` - кнопка для оформления заказа.

Методы:
`set items(items: HTMLElement[])` - устанавливает список элементов товаров в корзине. Если корзина пуста, отображает соответствующее сообщение и отключает кнопку заказа.
`set totalPrice(value: number)` - устанавливает текстовое содержимое для элемента `totalPriceEl`, отображая общую стоимость с "синапсов".

#### Класс Gallery
Назначение: Отображает список карточек товаров на главной странице. Отвечает за рендеринг всех доступных товаров.

Конструктор:
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент контейнера.

Поля:
`protected catalogEl: HTMLElement` - элемент-контейнер для отображения списка карточек товаров.

Методы:
`set items(items: HTMLElement[])` - устанавливает список элементов карточек товаров в каталоге.

#### Класс Header
Назначение: Отображает заголовок страницы. Включает логотип, навигацию и счетчик товаров в корзине.

Конструктор:
`constructor(container: HTMLElement, protected events: IEvents)` - принимает ссылку на DOM элемент контейнера и экземпляр брокера событий.

Поля:
`protected basketButton: HTMLElement` - кнопка для открытия корзины.
`protected basketCounter: HTMLElement` - элемент для отображения количества товаров в корзине.

Методы:
`set counter(value: number)` - устанавливает текстовое содержимое для элемента `basketCounter`, отображая количество товаров.
`get counter(): number` - возвращает текущее количество товаров в корзине.

#### Класс Modal
Назначение: Управляет отображением модальных окон. Предоставляет методы для открытия, закрытия и установки содержимого модальных окон.

Конструктор:
`constructor(container: HTMLElement, protected events: IEvents)` - принимает ссылку на DOM элемент контейнера модального окна и экземпляр брокера событий.

Поля:
`protected closeButton: HTMLElement` - кнопка для закрытия модального окна.
`protected contentContainer: HTMLElement` - контейнер для содержимого модального окна.

Методы:
`set content(content: HTMLElement)` - устанавливает содержимое модального окна.
`open()` - открывает модальное окно и инициирует событие `modal:open`.
`close()` - закрывает модальное окно и инициирует событие `modal:close`.
`render(): HTMLElement` - возвращает корневой DOM элемент модального окна.

#### Класс Success
Назначение: Отображает сообщение об успешном оформлении заказа. Показывает подтверждение заказа и его общую стоимость.

Конструктор:
`constructor(container: HTMLElement, actions?: ISuccessAction)` - принимает ссылку на DOM элемент контейнера и опциональный объект с действиями для успешного заказа.

Поля:
`protected valueEl: HTMLElement` - элемент для отображения общей стоимости заказа.
`protected submitButton: HTMLElement` - кнопка для закрытия сообщения об успешном заказе.

Методы:
`set value(value: number)` - устанавливает текстовое содержимое для элемента `valueEl`, отображая списанную сумму с "синапсов".

#### Класс Form
Назначение: Базовый класс для всех форм. Предоставляет общую логику для обработки ввода данных и валидации.

Конструктор:
`constructor(formContainer: HTMLElement, actions?: IFormAction)` - принимает ссылку на DOM элемент контейнера формы и опциональный объект с действиями для формы.

Поля:
`protected errorContainer: HTMLElement` - элемент для отображения ошибок валидации формы.
`protected submitElement: HTMLButtonElement` - кнопка отправки формы.

Методы:
`setSubmitState(disabled: boolean)` - устанавливает состояние активности кнопки отправки формы.
`resetErrors(): void` - очищает поле об ошибках.
`displayErrors(message: string): void` - отображает поле об ошибке.

#### Класс FormContacts
Назначение: Отображает форму для ввода контактных данных покупателя (email и телефон).

Конструктор:
`constructor(container: HTMLElement, actions?: IContactForm)` - принимает ссылку на DOM элемент контейнера формы и опциональный объект с действиями для формы контактов.

Поля:
`protected emailInput: HTMLInputElement` - поле ввода для электронной почты.
`protected phoneInput: HTMLInputElement` - поле ввода для номера телефона.
`protected submitorder: HTMLInputElement` - кнопка отправки заказа.

Методы:
`set email(value: string)` - устанавливает значение поля email.
`set phone(value: string)` - устанавливает значение поля phone.
`get email(): string` - возвращает значение поля email.
`get phone(): string` - возвращает значение поля phone.
`get data(): IContactData` - возвращает объект с данными email и phone.

#### Класс FormOrder
Назначение: Отображает форму для ввода адреса доставки и выбора способа оплаты.

Конструктор:
`constructor(container: HTMLElement, actions?: IOrderActionAddress)` - принимает ссылку на DOM элемент контейнера формы и опциональный объект с действиями для формы заказа.

Поля:
`protected addressInput: HTMLInputElement` - поле ввода для адреса доставки.
`protected paymentCashButton: HTMLButtonElement` - кнопка для выбора оплаты наличными.
`protected paymentCardButton: HTMLButtonElement` - кнопка для выбора оплаты картой.
`protected selectedPayment: string` - хранит выбранный способ оплаты.
`protected errors: HTMLElement` - элемент для отображения ошибок валидации.
`protected submitButton: HTMLButtonElement` - кнопка отправки формы.

Методы:
`private updatePaymentButtons()` - приватный метод для обновления стилей кнопок выбора оплаты.
`set payment(value: TPayment)` - устанавливает выбранный способ оплаты и обновляет кнопки.
`get payment(): string` - возвращает выбранный способ оплаты.
`set address(value: string)` - устанавливает значение поля адреса.
`get address(): string` - возвращает значение поля адреса.

### Слой презентера

Презентер отвечает за координацию взаимодействия между слоями Модели и Представления. Он слушает события, исходящие от Моделей и Представлений, обрабатывает их и вызывает соответствующие методы для обновления состояния данных или отображения интерфейса.

Основные функции презентера:
- Инициализация всех компонентов приложения.
- Подписка на события от представлений.
- Подписка на события от моделей.
- Обработка событий: обновление моделей, вызов методов представлений для отображения изменений, взаимодействие с API.
- Управление состоянием модальных окон.
- Валидация данных форм перед отправкой.

### События приложения

- `catalog:changed` - Обновление каталога товаров.
- `card:selected` - Выбор карточки товара для просмотра деталей.
- `card:add` - Добавление товара в корзину.
- `card:remove` - Удаление товара из корзины.
- `basket:open` - Открытие модального окна корзины.
- `cart:item:removed` - Удаление товара из корзины через список в модальном окне.
- `cart:order` - Переход к оформлению заказа из корзины.
- `order:validate` - Валидация данных формы адреса и оплаты.
- `order:submit` - Отправка данных формы адреса и оплаты.
- `contacts:validate` - Валидация данных формы контактов (email и телефон).
- `order:success` - Успешное оформление заказа.
